{% extends 'base.html' %}

{% block container %}

    <div class="box">
        <h2> {{ deckTitle }}</h2>
    </div>

    <div class="question-box">
        <button id="prevButton" class="card-button">&#8249;</button>

        <div id="card" class="card-question">
            <h3 id="next-question"> START </h3>
        </div>
        
        <button id="nextButton" class="card-button">&#8250;</button>
    </div>


    {% if isAuth %}

    <button id="add-card-button" class="button2" >Add Card</button>
    <button id="edit-card-button" class="button2" style="display: none">Edit</button>

    <form method="post" id="card-form" style="display: none">
        <svg id="close-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 30 30" width="120px" height="120px">
            <circle fill="#63514F" cx="15" cy="15" r="10" />
            <path fill="#D9D9D9" d="M15,3C8.373,3,3,8.373,3,15c0,6.627,5.373,12,12,12s12-5.373,12-12C27,8.373,21.627,3,15,3z M16.414,15 c0,0,3.139,3.139,3.293,3.293c0.391,0.391,0.391,1.024,0,1.414c-0.391,0.391-1.024,0.391-1.414,0C18.139,19.554,15,16.414,15,16.414 s-3.139,3.139-3.293,3.293c-0.391,0.391-1.024,0.391-1.414,0c-0.391-0.391-0.391-1.024,0-1.414C10.446,18.139,13.586,15,13.586,15 s-3.139-3.139-3.293-3.293c-0.391-0.391-0.391-1.024,0-1.414c0.391-0.391,1.024-0.391,1.414,0C11.861,10.446,15,13.586,15,13.586 s3.139-3.139,3.293-3.293c0.391-0.391,1.024-0.391,1.414,0c0.391,0.391,0.391,1.024,0,1.414C19.554,11.861,16.414,15,16.414,15z"/>
        </svg>
        <textarea name="question" required></textarea>
        <button class="button2">Done</button>
    </form>

    {% endif %}

    <script>
        const nextQuestion = document.querySelector("#next-question");
        const card = document.querySelector("#card");
        const prev = document.querySelector("#prevButton");
        const next = document.querySelector("#nextButton");

        var cardIndex = -1;
        var questions = '{{ cardList }}'

        questions = questions.replaceAll("&#39;","\"")
        var cardList = Array.from(JSON.parse(questions))
        cardList.push("END OF DECK")

        // event listener for prev button click
        function prevCard() {
            if (cardIndex > 0) {
                cardIndex -= 1;
                nextQuestion.textContent = cardList[cardIndex];
                document.querySelector("#add-card-button").style.display="initial"
                document.querySelector("#edit-card-button").style.display="initial"
            } else {
                nextQuestion.textContent = "START";
                document.querySelector("#add-card-button").style.display="initial"
                document.querySelector("#edit-card-button").style.display="none"
            }
        }

        prev.addEventListener("click", prevCard);

        // event listener for both card click and next button click
        function nextCard() {
            if (cardIndex == -1) {
                document.querySelector("#add-card-button").style.display="initial"
                document.querySelector("#edit-card-button").style.display="initial"
            }
            if (cardIndex < cardList.length-1) {
                cardIndex += 1;
                nextQuestion.textContent = cardList[cardIndex];
                if (cardIndex == cardList.length-1) {
                    document.querySelector("#add-card-button").style.display="none"
                    document.querySelector("#edit-card-button").style.display="none"
                }
            }
        }

        card.addEventListener("click", nextCard);
        next.addEventListener("click", nextCard);

        const username = "{{ username }}"
        const deckTitle = "{{ deckTitle }}"

        const addButton = document.querySelector("#add-card-button")
        addButton.addEventListener("click", async function() {
            document.querySelector("#next-question").style.display="none"
            document.querySelector("#add-card-button").style.display="none"
            document.querySelector("#edit-card-button").style.display="none"
            document.querySelector("#card-form").style.display="initial"

            document.querySelector("#card-form").action="/" + username + "/" + deckTitle + "/" + cardIndex + "/add"
        })

        const editButton = document.querySelector("#edit-card-button")
        editButton.addEventListener("click", function() {
            document.querySelector("#next-question").style.display="none"
            document.querySelector("#add-card-button").style.display="none"
            document.querySelector("#edit-card-button").style.display="none"
            document.querySelector("#card-form").style.display="initial"
            document.querySelector("#card-form textarea").textContent = cardList[cardIndex-1]

            document.querySelector("#card-form").action="/" + username + "/" + deckTitle + "/" + (cardIndex-1) + "/edit"
        })

        const closeIcon = document.querySelector("#close-icon")
        closeIcon.addEventListener("click", function() {
            document.querySelector("#next-question").style.display="initial"
            document.querySelector("#add-card-button").style.display="initial"
            document.querySelector("#edit-card-button").style.display="initial"
            document.querySelector("#card-form").style.display="none"
        })
    </script>

{% endblock %}

